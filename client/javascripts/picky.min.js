Array.prototype.index=function(b){for(var d=0,g=this.length;d<g;d++)if(this[d]==b)return d;return null};Array.prototype.include=function(b){return this.index(b)!==null};Array.prototype.remove=function(b){this.splice(b,1);return this};var PickyI18n={};$(function(){PickyI18n.locale=$("html").attr("lang").split("-")[0]||"en"});
var dictionary={common:{join:{de:"und",fr:"et",it:"e",en:"and",ch:"und"},"with":{de:"mit",fr:"avec",it:"con",en:"with",ch:"mit"},of:{de:"von",fr:"de",it:"di",en:"of",ch:"vo"},to:{de:"bis",fr:"\u00e0",it:"alla",en:"to",ch:"bis"}},results:{addination:{more:{de:"Weitere Resultate",fr:"Autres r\u00e9sultats",it:"Altri risultati",en:"More results",ch:"Mee Resultaat"}},header:{de:"Ergebnisse",fr:"R\u00e9sultats",it:"Risultati",en:"Results",ch:"Erg\u00e4bnis"}}},t=function(b){for(var d=PickyI18n.locale||
"en",g=b.split(".").concat(d),c=dictionary,e=0,r=g.length;e<r;e++){c=c[g[e]];if(c==undefined){c="Translation missing: "+b+"."+d;break}}return c};function Allocation(b,d,g,c,e,r){var f=this;this.type=b;this.weight=d;this.count=g;this.combination=c;this.ids=e||[];this.entries=this.rendered=r||[];this.isType=function(k){return k==f.type}}function Allocations(b){this.allocations=[];for(var d=0,g=b.length;d<g;d++){var c=b[d];this.allocations.push(new Allocation(c[0],c[1],c[2],c[3],c[4],c[5]))}this.length=this.allocations.length;this.each=function(e){return $.each(this.allocations,e)}}
function PickyData(b){var d=b.total,g=b.duration,c=b.offset;b=new Allocations(b.allocations||[]);this.total=d;this.duration=g;this.offset=c;this.allocations=b;this.isEmpty=function(){return d==0}};var PickyView=function(b,d){var g=d.showResultsLimit||10,c=$("#picky input.query"),e=$("#picky div.reset"),r=$("#picky input.search_button"),f=$("#picky div.status"),k=$("#picky .dashboard"),s=$("#picky .results"),o=$("#picky .no_results"),h=new PickyAddination(this,s),n=new PickyAllocationsCloud(this),u=new PickyResultsRenderer(h),w=function(){e.fadeTo(166,1)},z=function(){n.hide();s.empty();o.hide()},D=function(m){c.val(m);e.fadeTo(166,0);B("empty");f.empty();z()},x=function(){return c.val()};this.text=
x;var A=function(m){f.text(m);m>0&&m<=5&&f.fadeTo("fast",0.5).fadeTo("fast",1)},E=function(m){if(m.isEmpty())return"none";if(m.total>g&&m.allocations.length>1)return"support";return"ok"},B=function(m){k.attr("class","dashboard "+m)};this.insert=function(m){c.val(m);c.select()};this.fullResultsCallback=function(m){B(E(m));if(m.isEmpty()){z();A(0);o.show();w()}else if(m.total>g&&m.allocations.length>1){z();w();n.show(m);A(m.total)}else if(m.offset==0){z();A(m.total);u.render(m);s.show();w()}else{h.remove();
u.render(m);$.scrollTo("#picky .results div.info:last",{duration:500,offset:-12})}c.focus()};this.liveResultsCallback=function(m){B(E(m));A(m.total)};this.allocationChosen=function(m){m=m.data.query;c.val(m);b.allocationChosen(m)};this.addinationClicked=function(m){b.addinationClicked(x(),m)};(function(){c.keyup(function(m){if(x()==""){D();b.searchTextCleared()}else{b.searchTextEntered(x(),m);w()}});r.click(function(){x()==""||b.searchButtonClicked(x())});e.click(function(){D("");b.clearButtonClicked();
c.focus()})})();c.focus()};var PickyBackend=function(b){var d=function(g,c,e,r){var f=r||{};f=$.extend({query:g,offset:e},r);$.ajax({type:"GET",url:b,data:f,success:function(k){c&&c(new PickyData(k))},dataType:"json"})};this.search=function(g,c,e,r,f){d(g,function(k){c&&c(f,k)},e,r)}},LiveBackend=function(b){var d=new PickyBackend(b);this.search=function(g,c,e,r,f){f=f||{};latestRequestTimestamp=new Date;f.live=latestRequestTimestamp;d.search(g,function(k,s){if(!k.live||k.live==latestRequestTimestamp)c&&c(s)},e,r,f)}},FullBackend=
function(b){var d=new PickyBackend(b);this.search=function(g,c,e,r,f){f=f||{};latestRequestTimestamp=new Date;f.full=latestRequestTimestamp;d.search(g,function(k,s){if(!k.full||k.full==latestRequestTimestamp)c&&c(s)},e,r,f)}};var PickyController=function(b){var d=new PickyView(this,b),g=b.backends,c=b.before||function(){},e=b.success||function(){},r=b.after||function(){},f=function(h,n){h=e(h,n)||h;d.fullResultsCallback(h);r(h,n)},k=function(h,n,u){u=u||{};n=n||0;o.stop();$.address&&$.address.parameter("q",h);u=c(u,h,n)||u;var w=g.full;w&&w.search(h,f,n,u)},s=function(h,n){h=e(h,n)||h;d.liveResultsCallback(h);r(h,n)},o=$.timer(180,function(h){var n=d.text();c({});var u=g.live;u&&u.search(n,s,0,void 0);h.stop()});o.stop();
this.insert=function(h,n){d.insert(h);n&&k(h)};this.clearButtonClicked=function(){o.stop()};this.searchTextCleared=function(){o.stop()};this.searchTextEntered=function(h,n){if($.inArray(n.keyCode,[0,8,13,32,46,48,49,50,51,52,53,54,55,56,57,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90])>-1)n.keyCode==13?k(h):o.reset()};this.searchButtonClicked=function(h){k(h)};this.allocationChosen=function(h){k(h)};this.addinationClicked=function(h,n){k(h,n.data.offset)}};var Localization={location_delimiters:{de:"in",fr:"\u00e0",it:"a",en:"in",ch:"in"},explanation_delimiters:{de:"und",fr:"et",it:"e",en:"and",ch:"und"}},PickyClient=function(b){Localization.qualifiers=b.qualifiers||{};Localization.explanations=b.explanations||{};Localization.explanation_delimiters={de:"und",fr:"et",it:"e",en:"and",ch:"und"};var d=b.backends;if(d){d.live||alert("Both a full and live backend must be provided.");d.full||alert("Both a full and live backend must be provided.")}else b.backends=
{live:b.live&&new LiveBackend(b.live)||alert("A live backend path must be provided."),full:b.full&&new FullBackend(b.full)||alert("A live backend path must be provided.")};var g=b.controller&&new b.controller(b)||new PickyController(b);var c=this.insert=function(e,r){g.insert(e,r||true)};this.insertFromURL=function(e){if(e&&e!="")c(e);else $.address&&c($.address.parameter("q"))};$.address&&$.address.externalChange(function(e){(e=e.parameters.q)&&c(e)})};var PickyAddination=function(b,d){this.remove=function(){d.find(".addination").remove()};this.render=function(g){var c=g.total,e=void 0;e=e||0;e=g.offset+20+e;var r=e+20;g=g.total;if(g<r)r=g;g={offset:e,start:e+1,end:r};if(g.offset<c){c=$("<div class='addination current'>"+t("results.addination.more")+"<div class='tothetop'><a href='javascript:$.scrollTo(0,{ duration: 500});'>&uarr;</a></div></div>");c.bind("click",{offset:g.offset},b.addinationClicked);return c}else return""}};var PickyResultsRenderer=function(b){var d=["street_number","zipcode"],g=function(f){var k=f[f.length-1];f=f.slice(0,f.length-1);if(f==[])f=[f];if(!d.include(k[0]))if(k[1].match(/[^\*~]$/))k[1]+="*";f.push(k);return f},c=function(f){for(var k=Localization.explanations&&Localization.explanations[PickyI18n.locale]||{},s=[],o,h=0,n=f.length;h<n;h++){o=f[h];var u=o[0];u=k[u]||u;s.push([u,o[1]])}return s},e=function(f,k){var s=Localization.explanation_delimiters[PickyI18n.locale],o=c(g(k));o=$.map(o,function(h){return[h[0].replace(/([\w\s\u00c4\u00e4\u00d6\u00f6\u00dc\u00fc\u00e9\u00e8\u00e0]+)/,
"<strong>$1</strong>"),h[1]].join(" ")});o=o.join(" "+s+" ");return'<div class="explanation">'+f+" "+o+"</div>"},r=function(f,k){var s='<div class="info">';s+=e(k.type,k.combination);if(f.offset>0)s+='<div class="tothetop"><a href="javascript:$.scrollTo(0,{ duration: 500 });">&uarr;</a></div>';s+='<div class="clear"></div></div>';return s};this.render=function(f){var k=$("#picky .results");f.allocations.each(function(s,o){k.append(r(f,o)).append(o.entries.join("")).append(b.render(f))})}};function AllocationRenderer(b){function d(a){var i={},p={},j=[],q;q=0;for(l=a.length;q<l;q++){var v=a[q][0];if(v in i){i[v]=i[v]+" "+a[q][1];j.push(q)}else{i[v]=a[q][1];p[q]=v}}for(q in p)a[q][1]=i[p[q]];for(q=j.length-1;q>=0;q--)a.remove(j[q]);return a}function g(a,i){var p=i||false,j=a[0],q=a[1],v=D[j];if(v){if(v.method)q=q[v.method]();if(v.format)q=v.format.replace(/%1\$s/,q)}j=w[j]||j;if(p&&!(v&&v.ignoreSingle))return q+"&nbsp;("+j+")";return q}function c(a){if(a.length==0)return"";else if(a.length==
1)return g(a[0],true);else{var i=[],p=[];a=d(a);for(var j=0,q=a.length;j<q;j++)if(a[j][0]=="first_name")i.unshift(g(a[j]));else a[j][0]=="maiden_name"?p.push(g(a[j])):i.push(g(a[j]));p.length>0&&i.push(p);return i.join(" ")}}function e(a){return function(i,p){for(var j=0,q=a.length;j<q;j++)if(a[j][0]==p)return a[j][1];return""}}function r(a){if(a.length==0)return"";var i=a=d(a);i.sort(function(v,y){return v[0]<y[0]?-1:1});for(var p=[],j=0,q=i.length;j<q;j++)p.push(i[j][0]);return x[p].replace(/:(zipcode|city)/g,
e(a))}function f(a){var i=a[0];return a[1]+"&nbsp;("+(w[i]||i)+")"}function k(a){if(a.length==0)return"";result=[];a=d(a);for(var i=0,p=a.length;i<p;i++)result.push(f(a[i]));return result.join(", ")}function s(a){for(var i=[],p=[],j=[],q=0,v=a.length;q<v;q++){var y=a[q];if(E.include(y[0]))j.push(y);else A.include(y[0])?i.push(y):p.push(y)}var C;if(j.length>0)C=j[j.length-1];else if(p.length>0)C=p[p.length-1];else if(i.length>0)C=i[i.length-1];z.include(C[0])||(C[1]+="...");a=c(i);p=k(p);j=r(j);return[a,
p,j]}function o(a){var i=a[0],p=a[1];a=a[2];var j="";j=i!=""?p!=""?[i,p].join(B):i:p;if(a=="")return j;return[j,a].join(m)}function h(a){var i=[],p,j;for(j in a){p=a[j][0];p=u[p]||p;i[j]=p+":"+a[j][1]}return i.join(" ")}var n=PickyI18n.locale,u=Localization.qualifiers&&Localization.qualifiers[n]||{},w=Localization.explanations&&Localization.explanations[n]||{};n=Localization.location_delimiters[n];this.explanation=this.query=this.text="";var z=["street_number","zipcode"];this.contract=d;var D={maiden_name:{format:"(-%1$s)",
method:"capitalize",ignoreSingle:true},name:{format:"<strong>%1$s</strong>",method:"toUpperCase",ignoreSingle:true},first_name:{format:"%1$s",method:"capitalize"}};this.who=c;var x={zipcode:":zipcode ["+w.city+"]",city:":city","city,zipcode":":zipcode :city"};this.where=r;this.what=k;var A=["first_name","name","maiden_name"],E=["zipcode","city"];this.trisect=s;var B=", ",m=" "+n+"&nbsp;";this.fuse=o;this.querify=h;this.render=function(a){var i=a.combination,p=a.count;a=h(i);i=o(s(i));i=$('<li><div class="text">'+
i+'</div><div class="count">'+p+"</div></li>");i.bind("click",{query:a},b);return i}};var PickyAllocationsCloud=function(b){var d=$("#picky .allocations"),g=d.find(".shown"),c=d.find(".more"),e=d.find(".hidden"),r=function(){d.hide()},f=new AllocationRenderer(function(o){r();b.allocationChosen(o)}),k=function(o){var h=[];o.each(function(n,u){h.push(f.render(u))});return h},s=function(o){if(o.length==0)return $("#search .allocations").hide();g.empty();c.hide();e.empty().hide();if(o.length>3){$.each(o.slice(0,2),function(h,n){g.append(n)});$.each(o.slice(2),function(h,n){e.append(n)});
c.show()}else $.each(o,function(h,n){g.append(n)});return $("#search .allocations").show()};c.click(function(){c.hide();e.show()});this.hide=r;this.show=function(o){s(k(o.allocations));d.show()}};
